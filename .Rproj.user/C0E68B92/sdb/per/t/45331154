{
    "collab_server" : "",
    "contents" : "## app.R ##\nlibrary(shinydashboard)\nlibrary(data.table)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(highcharter)\nlibrary(leaflet)\nlibrary(rgdal)\nlibrary(maptools)\nlibrary(magrittr)\nlibrary(ggthemes)\n\n## 讀入所需資料(原始資料包資料)\n\nc(\"#A6CEE3\",\"#1F78B4\",\"#B2DF8A\",\"#33A02C\",\"#FB9A99\",\"#E31A1C\",\"#FDBF6F\",\"#FF7F00\",\"#CAB2D6\",\"#6A3D9A\") -> col.raw# data_cluster <- fread('./20160613_data_cluster.csv')\ncbind(grDevices::col2rgb(col.raw),3) -> col\n# radar.data <- read.csv('./20160613_Radar_plot.csv') %>%\n#   mutate_each(funs(round(.,digits=2)),-index)\n# radar.data$mean <- rowMeans(radar.data[,-1])\ndata <- fread('iconv -f big5 -t utf8 ./data_hack.csv')\ndata %>% select(統計年月,縣市,行政區域,每人平均用電度數) -> power\n# power <- fread('iconv -f big5 -t utf8 origin_data/power_twomonth.csv')\npower_area <- power %>% mutate(鄉鎮 = substring(行政區域,1,3))\nsfn <- readOGR(dsn = 'map/Village_NLSC_1050219.shp',\n               layer='Village_NLSC_1050219', stringsAsFactors = F,\n               verbose = F)\n## demo專用\nradar<- read.csv('20160613_Radar_plot.csv') %>%\n  mutate_each(funs(round(.,digits=2)),-index)\nradar$mean <- rowMeans(radar[,-1])\n### demo用雷達圖\nhcmix = highchart() %>% \n  hc_chart(polar = TRUE, type = \"line\") %>% \n  hc_xAxis(categories = radar$index,\n           tickmarkPlacement = 'on',\n           lineWidth = 0) %>% \n  hc_yAxis(gridLineInterpolation = 'polygon',\n           lineWidth = 0,\n           min = 0, max = 1) %>% \n  hc_series(\n    list(\n      name = \"Cluster-3\",\n      data = radar[,c(2)],\n      pointPlacement = 'on',color=col.raw[1]),\n    list(\n      name = \"Cluster-2\",\n      data = radar[,c(3)],\n      pointPlacement = 'on',color=col.raw[2]),\n    list(\n      name = \"Cluster-1\",\n      data = radar[,c(4)],\n      pointPlacement = 'on',color=col.raw[3]),\n    list(\n      name = \"Cluster-4\",\n      data = radar[,c(5)],\n      pointPlacement = 'on',color=col.raw[4]),\n    list(\n      name = \"Cluster-5\",\n      data = radar[,c(6)],\n      pointPlacement = 'on',color=col.raw[5]),\n    list(\n      name = \"Overall-Mean\",\n      data = radar[,c(10)],\n      pointPlacement = 'on',color='#474747'))\n\noptions(scipen = 100)\nui <- dashboardPage(\n  dashboardHeader(title = \"Power Hackathon Asia\",titleWidth = 300),\n  dashboardSidebar(\n    sidebarMenu(\n      menuItem(\"台北市用電量概況\", tabName = \"overview\", icon = icon(\"bar-chart\")),\n      menuItem(\"各行政區用電量概況\", tabName = \"area\", icon = icon(\"plug\")),\n      menuItem(\"節電對象之輪廓\", tabName = \"compare\", icon = icon(\"user\")),\n      menuItem(\"節電對象分群範例\", tabName = \"demo\", icon = icon(\"sitemap\"))\n    ),\n    h4(\"Hi All :\",style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n    p(\"這份Dashboard是我們參加\",\n      a(\"105年亞洲跨國黑客競賽\",href=\"http://opendata.tca.org.tw/hackathon/#one\"),\"的產品。\n        因為時間關係，還有諸多可以做更好的地方！\n        若對此分析有任何建議，\n        期望各界高手能夠提供寶貴的意見\n        或是相關的資料給我們，未來\n        一起創造開放資料的價值。\",\n      style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n    h4(strong(\"粉紅高壓電團隊簡介：\")),\n    p(a(\"1. 楊崇甫(ALGER)-政大統計碩二\",\n        href=\"https://www.linkedin.com/in/%E5%B4%87%E7%94%AB-%E6%A5%8A-291242124\"),\n      style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n    p(a(\"2. 陳昱霈(GU)-政大統計碩二\",href=\"https://www.linkedin.com/in/yu-pei-chen-b852ba110\"),\n      style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n    p(a(\"3. 林敬昇(Lin)-政大統計碩二\",href=\"https://www.linkedin.com/in/lincingsheng\"),\n      style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n    p(a(\"4. 蘆葦寧(Ning)-政大企研碩一\",href=\"https://www.facebook.com/iamningl?fref=ts\"),\n      style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\")\n  ),\n  dashboardBody(\n    tabItems(\n      tabItem(tabName = 'overview',\n              fluidRow(\n                tags$iframe(src = \"https://unityculturesheng.carto.com/viz/35497786-1716-11e6-bc60-0e3ff518bd15/embed_map\",\n                                   width=\"100%\" ,height=\"520\")),\n              fluidRow(\n                column(\n                  width = 4,\n                  box(width = NULL, status = 'warning', title = \"用電大戶基本查詢:\",\n                      solidHeader = TRUE, collapsible = T, \n                      selectInput('overview_time_big', \n                                  label = \"用電大戶里查詢(雙月制)：\", \n                                  choices = unique(power$統計年月),\n                                  selected = 10505),selectInput('overview_n_big', \n                                                                label = \"用電大戶前幾名：\", \n                                                                choices = c(1:30),\n                                                                selected = 5)\n                  ),\n                  box(width = NULL, status = 'warning', title = \"用電成長幅度基本查詢:\",\n                      solidHeader = TRUE, collapsible = T, \n                      fluidRow(\n                        column(width = 6,\n                               selectInput('overview_time_growth1', \n                                           label = \"耗電成長里查詢(雙月制) - 基期：\", \n                                           choices = unique(power$統計年月),\n                                           selected = 10405)), # 第一個算不出成長\n                        column(width = 6,\n                               selectInput('overview_time_growth2', \n                                           label = \"耗電成長里查詢(雙月制) - 當期：\", \n                                           choices = unique(power$統計年月),\n                                           selected = 10505))\n                      ),\n                      selectInput('overview_n_growth', \n                                  label = \"成長幅度前幾名：\", \n                                  choices = c(1:30),\n                                  selected = 5)\n                  )\n                ),\n                column(\n                  width = 8,\n                  tabBox(\n                    width = NULL,\n                    tabPanel(h5('用電大戶'), status = 'info', height = 400,\n                             plotlyOutput(\"overview_big_plot\")\n                    ),\n                    tabPanel(h5('用電大戶所在位置'), status = 'info', height = 400,\n                             leafletOutput(\"map_big\")\n                    ),\n                    tabPanel(h5('用電成長大戶'), status = 'info', height = 400,\n                             plotlyOutput(\"overview_growth_plot\")\n                    ),\n                    tabPanel(h5('用電成長大戶所在位置'), status = 'info', height = 400,\n                             leafletOutput(\"map_growth\")\n                    ),\n                    tabPanel(h5('歷年月各村里每人用電度數'), status = 'info', height = 400,\n                             plotlyOutput('yearmap')\n                    )\n                  )\n                )\n             ),\n             fluidRow(\n               column(\n                 width = 4,\n                 box(width = NULL, status = 'info', title = \"省電大戶基本查詢:\",\n                     solidHeader = TRUE, collapsed = T, collapsible = T, \n                     selectInput('overview_time_small', \n                                 label = \"省電大戶里查詢(雙月制)：\", \n                                 choices = unique(power$統計年月),\n                                 selected = 10407),\n                     selectInput('overview_n_small', \n                                 label = \"省電大戶前幾名：前幾名：\", \n                                 choices = c(1:30),\n                                 selected = 5)\n                 ),\n                 box(width = NULL, status = 'info', title = \"省電成長幅度基本查詢:\",\n                     solidHeader = TRUE, collapsed = T, collapsible = T, \n                     fluidRow(\n                       column(width = 6,\n                              selectInput('overview_time_decay1', \n                                          label = \"省電成長里查詢(雙月制) - 基期：\", \n                                          choices = unique(power$統計年月),\n                                          selected = 10405)), # 第一個算不出成長\n                       column(width = 6,\n                              selectInput('overview_time_decay2', \n                                          label = \"省電成長里查詢(雙月制) - 當期：\", \n                                          choices = unique(power$統計年月),\n                                          selected = 10407))\n                     ),\n                     selectInput('overview_n_decay', \n                                 label = \"省電成長幅度前幾名：\", \n                                 choices = c(1:30),\n                                 selected = 5)\n                     )\n             ),\n             column(\n               width = 8,\n               tabBox(\n                 width = NULL,\n                 tabPanel(h5('省電大戶'), status = 'info', height = 400,\n                          plotlyOutput(\"overview_small_plot\")),\n                 tabPanel(h5('省電大戶所在位置'), status = 'info', height = 400,\n                          leafletOutput(\"map_sml\")\n                 ),\n                 tabPanel(h5('省電成長大戶'), status = 'info', height = 400,\n                          plotlyOutput(\"overview_decay_plot\")),\n                 tabPanel(h5('省電幅度高之所在位置'), status = 'info', height = 400,\n                          leafletOutput(\"map_sml_growth\")\n                 ),\n                 tabPanel(h5('歷年各村里省電度數'), status = 'info', height = 400,\n                          plotlyOutput(\"yearmap1\")\n                 )\n               )\n             )\n           )\n    ),\n    tabItem(tabName = \"compare\",\n            fluidRow(\n              column(\n                width = 4,\n                box(width = NULL, status = 'info', height = 500, title = \"人口特性比較\",\n                    selectInput('n_big', \n                                label = \"用電大戶前幾名：\", \n                                choices = c(1:10),\n                                selected = 5),\n                    selectInput('n_small', \n                                label = \"省電大戶前幾名：\", \n                                choices = c(1:10),\n                                selected = 5),\n                    selectInput('yearmonth', \n                                label = \"選擇年月：\", \n                                choices = unique(power$統計年月),\n                                selected = 10407),\n                    infoBoxOutput(\"電力\",width = 100),\n                    infoBoxOutput(\"時間\",width = 100)\n                )\n              ),\n              box(width = 8, status = 'info', height = 500, title = \"選擇 :\",\n                  highchartOutput(outputId = \"big_small_competion\")\n                )\n             )\n    ),\n    tabItem(tabName = 'area',\n            fluidRow(\n              column(\n                width = 4,\n                box(width = NULL, status = 'warning', height = 500, title = \"用電大戶基本查詢: \",\n                    solidHeader = T,\n                    selectInput('area_c', \n                                label = \"選擇村里\", \n                                choices = unique(power_area$鄉鎮),\n                                selected = \"北投區\"),\n                    selectInput('detail_time_big', \n                                label = \"用電大戶里查詢(雙月制)：\", \n                                choices = unique(power$統計年月),\n                                selected = 10407),\n                    selectInput('detail_n_big', \n                                label = \"用電大戶前幾名：\", \n                                choices = c(1:10),\n                                selected = 5),\n                    fluidRow(\n                      column(width = 6,\n                             selectInput('detail_time_growth1', \n                                         label = \"用電成長里查詢(雙月制) - 基期：\", \n                                         choices = unique(power$統計年月),\n                                         selected = 10405)), # 第一個算不出成長\n                      column(width = 6,\n                             selectInput('detail_time_growth2', \n                                         label = \"用電成長里查詢(雙月制) - 當期：\", \n                                         choices = unique(power$統計年月),\n                                         selected = 10407))\n                    ),\n                    selectInput('detail_n_growth', \n                                label = \"用電成長幅度前幾名：\", \n                                choices = c(1:10),\n                                selected = 5)\n                )\n              ),\n              column(\n                width = 8,\n                tabBox(\n                  width = NULL,\n                  tabPanel(h5('用電大戶'), status = 'info', height = 400,\n                           plotlyOutput(\"detail_big_plot\")),\n                  tabPanel(h5('用電成長大戶'), status = 'info', height = 400,\n                           plotlyOutput(\"detail_growth_plot\"))\n                )\n              )\n            ),\n            fluidRow(\n              column(\n                width = 4,\n                box(width = NULL, status = 'info', height = 500, title = \"省電大戶基本查詢:\",\n                    solidHeader = T,\n                    selectInput('area_d', \n                                label = \"選擇村里\", \n                                choices = unique(power_area$鄉鎮),\n                                selected = \"北投區\"),\n                    selectInput('detail_time_small', \n                                label = \"省電大戶里查詢(雙月制)：\", \n                                choices = unique(power$統計年月),\n                                selected = 10407),\n                    selectInput('detail_n_small', \n                                label = \"省電大戶前幾名：\", \n                                choices = c(1:10),\n                                selected = 5),\n                    fluidRow(\n                      column(width = 6,\n                             selectInput('detail_time_decay1', \n                                         label = \"省電成長里查詢(雙月制) - 基期：\", \n                                         choices = unique(power$統計年月),\n                                         selected = 10405)), # 第一個算不出成長\n                      column(width = 6,\n                             selectInput('detail_time_decay2', \n                                         label = \"省電成長里查詢(雙月制) - 當期：\", \n                                         choices = unique(power$統計年月),\n                                         selected = 10407))\n                    ),\n                    selectInput('detail_n_decay', \n                                label = \"省電成長幅度前幾名：\", \n                                choices = c(1:10),\n                                selected = 5)\n                )\n              ),\n              column(\n                width = 8,\n                tabBox(\n                  width = NULL,\n                  tabPanel(h5('省電大戶'), status = 'info', height = 400,\n                           plotlyOutput(\"detail_small_plot\")),\n                  tabPanel(h5('省電成長大戶'), status = 'info', height = 400,\n                           plotlyOutput(\"detail_decay_plot\"))\n                )\n              )\n            )\n    ),\n    tabItem(tabName = \"demo\",\n            fluidRow(\n              column(\n                width = 4,\n                box(width = NULL, status = 'info', height = 500,\n                    infoBoxOutput(\"approvalBox\",width = 100),\n                    selectInput('yearmonth', \n                                label = \"選擇年月：\", \n                                choices = unique(power$統計年月),\n                                selected = 10407),\n                    infoBoxOutput(\"人口特性\",width = 100),\n                    infoBoxOutput(\"單身小資\",width = 100),\n                    infoBoxOutput(\"高知識\",width = 100),\n                    infoBoxOutput(\"銀髮族\",width = 100)\n                )\n              ),\n              box(width = 8, status = 'info', height = 500, title = \"選擇 :\",\n                  highchartOutput(outputId = \"demo\")\n              )\n            ),\n            fluidRow(\n              tags$iframe(src = \"https://unityculturesheng.carto.com/viz/973a42ea-315b-11e6-b013-0e3a376473ab/embed_map\",\n                          width=\"100%\" ,height=\"520\"))\n    )\n  )\n )\n)\n\n\nserver <- function(input, output) {\n  output$overview_big_plot <- renderPlotly({\n    power %>% \n      filter(統計年月 == input$overview_time_big) %>% \n      arrange(desc(每人平均用電度數)) %>% \n      slice(1:input$overview_n_big) %>% \n      ggplot(aes(x = reorder(行政區域, desc(每人平均用電度數)), y = 每人平均用電度數)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5)))-> plot_tmp\n    ggplotly(plot_tmp)\n  })\n  \n  output$overview_growth_plot <- renderPlotly({\n    power %>% \n      filter(統計年月 %in% c(input$overview_time_growth1,input$overview_time_growth2)) %>%\n      group_by(行政區域) %>% \n      arrange(desc(統計年月)) %>% \n      mutate(base = lead(每人平均用電度數, 1),\n             用電量成長比例 = (每人平均用電度數 - base)/base) %>% \n      ungroup %>% \n      arrange(desc(用電量成長比例)) %>% \n      slice(1:input$overview_n_growth) %>% \n      ggplot(aes(x = reorder(行政區域, desc(用電量成長比例)), y = 用電量成長比例)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5))) -> plot_tmp1\n    ggplotly(plot_tmp1)\n  })\n  \n  ## 省電大戶 by lofu\n  output$overview_small_plot <- renderPlotly({\n    power %>% \n      filter(統計年月 == input$overview_time_small) %>% \n      arrange(每人平均用電度數) %>% \n      slice(1:input$overview_n_small) %>% \n      ggplot(aes(x = reorder(行政區域,每人平均用電度數), y = 每人平均用電度數)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5))) -> plot_tmp2\n    ggplotly(plot_tmp2)\n  })\n  \n  ## 省電成長大戶 by lofu\n  output$overview_decay_plot <- renderPlotly({\n    power %>% \n      filter(統計年月 %in% c(input$overview_time_decay1,input$overview_time_decay2)) %>%\n      group_by(行政區域) %>% \n      arrange(desc(統計年月)) %>% \n      mutate(base = lead(每人平均用電度數, 1),\n             省電量成長比例 = (每人平均用電度數 - base)/base) %>% \n      ungroup %>% \n      arrange(省電量成長比例) %>% \n      slice(1:input$overview_n_decay) %>% \n      ggplot(aes(x = reorder(行政區域, 省電量成長比例), y = 省電量成長比例)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =45 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5))) -> plot_tmp3\n    ggplotly(plot_tmp3)\n  })\n  \n  output$yearmap <- renderPlotly({\n    power %>% \n      filter(統計年月 == input$overview_time_big) %>% \n      arrange(desc(每人平均用電度數)) %>% \n      slice(1:input$overview_n_big) %$% 行政區域 -> vname_big\n    \n    power %>% \n      filter(行政區域 %in% vname_big) %>% \n      ggplot(aes(x = 統計年月 %>% as.factor() , y = 每人平均用電度數 , group = 行政區域 , color = 行政區域)) + \n      geom_line() + \n      geom_point() + \n      theme_bw(base_family=\"STHeiti\") + \n      labs(x = '統計年月', title = \"歷年月每人平均用電度數\") + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5)))+\n      coord_cartesian(ylim = c(250,1200)) -> temp\n      ggplotly(temp)\n    \n  })\n  \n  output$yearmap1 <- renderPlotly({\n    power %>% \n      filter(統計年月 == input$overview_time_small) %>% \n      arrange(每人平均用電度數) %>% \n      slice(1:input$overview_n_small) %$% 行政區域 -> vname_small\n    \n    power %>% \n      filter(行政區域 %in% vname_small) %>% \n      ggplot(aes(x = 統計年月 %>% as.factor() , y = 每人平均用電度數 , group = 行政區域 , color = 行政區域)) + \n      geom_line() + \n      geom_point() + \n      theme_bw(base_family=\"STHeiti\") + \n      labs(x = '統計年月', title = \"歷年月每人平均省電度數\") + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5)))+\n      coord_cartesian(ylim = c(0,500)) -> temp_small\n    ggplotly(temp_small)\n    \n  })\n  \n  output$map_big <- renderLeaflet({\n    power %>% \n      filter(統計年月 == input$overview_time_big) %>% \n      arrange(desc(每人平均用電度數)) %>% \n      slice(1:input$overview_n_big) %$% 行政區域 -> vname_big\n    leaflet(sfn %>% subset(paste0(sfn$T_Name, sfn$V_Name) %in% vname_big)) %>%\n      addPolygons(\n        stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5\n      ) %>% \n      setView(lng = 121.536862, lat = 25.045235, zoom = 11) %>% addTiles()\n })\n  \n  output$map_growth <- renderLeaflet({\n    power %>% \n      filter(統計年月 %in% c(input$overview_time_growth1,input$overview_time_growth2)) %>%\n      group_by(行政區域) %>% \n      arrange(desc(統計年月)) %>% \n      mutate(base = lead(每人平均用電度數, 1),\n             用電量成長比例 = (每人平均用電度數 - base)/base) %>% \n      ungroup %>% \n      arrange(desc(用電量成長比例)) %>% \n      slice(1:input$overview_n_growth) %$% 行政區域 -> vname_growth\n    leaflet(sfn %>% subset(paste0(sfn$T_Name, sfn$V_Name) %in% vname_growth)) %>%\n      addPolygons(\n        stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5\n      ) %>% \n      setView(lng = 121.536862, lat = 25.045235, zoom = 11) %>% addTiles()\n  })\n  \n  ## 省電地圖\n  output$map_sml <- renderLeaflet({\n    power %>% \n      filter(統計年月 == input$overview_time_small) %>% \n      arrange(desc(每人平均用電度數)) %>% \n      slice(1:input$overview_n_small) %$% 行政區域 -> vname_big\n    leaflet(sfn %>% subset(paste0(sfn$T_Name, sfn$V_Name) %in% vname_big)) %>%\n      addPolygons(\n        stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5\n      ) %>% \n      setView(lng = 121.536862, lat = 25.045235, zoom = 11) %>% addTiles()\n  })\n  \n  output$map_sml_growth <- renderLeaflet({\n    power %>% \n      filter(統計年月 %in% c(input$overview_time_decay1,input$overview_time_decay2)) %>%\n      group_by(行政區域) %>% \n      arrange(desc(統計年月)) %>% \n      mutate(base = lead(每人平均用電度數, 1),\n             省電量成長比例 = (每人平均用電度數 - base)/base) %>% \n      ungroup %>% \n      arrange(省電量成長比例) %>% \n      slice(1:input$overview_n_decay) %$% 行政區域 -> vname_sml_growth\n    leaflet(sfn %>% subset(paste0(sfn$T_Name, sfn$V_Name) %in% vname_sml_growth)) %>%\n      addPolygons(\n        stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5\n      ) %>% \n      setView(lng = 121.536862, lat = 25.045235, zoom = 11) %>% addTiles()\n  })\n  \n  output$big_small_competion <- renderHighchart({\n    data %>% \n      filter(統計年月 == input$yearmonth) %>%\n      select(行政區域,每戶平均用電度數,\n                 女性比例, 男性比例,\n                 少年人口比例,青年人口比例,壯年人口比例,老年人口比例,總人數,有偶人數,\n                 綜合所得中位數, 大學以上比例, 大學比例, 大學以下比例) %>% \n      mutate(扶老比_log = log10((1-青年人口比例-壯年人口比例-少年人口比例)/(青年人口比例+壯年人口比例)),\n                 有偶比例 = 有偶人數/((1-少年人口比例)*總人數),\n                 平均教育程度 = 大學以上比例*6+大學比例*4+大學以下比例*0,\n                 女男比 = round(女性比例/男性比例,4),\n                 綜合所得中位數_log = log10(綜合所得中位數),\n                 每戶平均用電度數_log = log10(每戶平均用電度數)) %>% \n      select(行政區域,綜合所得中位數_log,平均教育程度,有偶比例,女男比,扶老比_log,每戶平均用電度數_log) %>%\n      mutate_each(funs(scale(.)),-行政區域) %>% #崇甫續寫\n      gather('index','value',-行政區域) %>% \n      group_by(index) %>% \n      mutate(value = (value-min(value))/(max(value)-min(value))) %>% \n      spread(index,value) %>% \n      arrange(desc(每戶平均用電度數_log)) %>% #挑出最上與最下\n      slice(1:input$n_big) %>% \n      select(2:7) %>% \n      summarise_each(funs(mean)) %>% \n      mutate(group = \"top\") %>% \n      bind_rows(\n        data %>% \n          filter(統計年月 == input$yearmonth) %>% \n          select(行政區域,每戶平均用電度數,\n                     女性比例, 男性比例,\n                     少年人口比例,青年人口比例,壯年人口比例,老年人口比例,總人數,有偶人數,\n                     綜合所得中位數, 大學以上比例, 大學比例, 大學以下比例) %>% \n          mutate(扶老比_log = log10((1-青年人口比例-壯年人口比例-少年人口比例)/(青年人口比例+壯年人口比例)),\n                     有偶比例 = 有偶人數/((1-少年人口比例)*總人數),\n                     平均教育程度 = 大學以上比例*6+大學比例*4+大學以下比例*0,\n                     女男比 = round(女性比例/男性比例,4),\n                     綜合所得中位數_log = log10(綜合所得中位數),\n                     每戶平均用電度數_log = log10(每戶平均用電度數)) %>% \n          select(行政區域,綜合所得中位數_log,平均教育程度,有偶比例,女男比,扶老比_log,每戶平均用電度數_log) %>%\n          mutate_each(funs(scale(.)),-行政區域) %>% #崇甫續寫 \n          gather('index','value',-行政區域) %>% \n          group_by(index) %>% \n          mutate(value = (value-min(value))/(max(value)-min(value))) %>% \n          spread(index,value) %>% \n          arrange(每戶平均用電度數_log) %>% #挑出最上與最下\n          slice(1:input$n_small) %>% \n          select(2:7) %>% \n          summarise_each(funs(mean)) %>% \n          mutate(group = \"down\")\n      ) %>% \n      gather(index,value,1:6) %>% \n      spread(group,value) %>% as.data.frame()-> temp_rada\n    \n    highchart() %>% \n      hc_chart(polar = TRUE, type = \"line\") %>% \n      hc_title(text = \"用電大戶與省電大戶的人口特性比較\") %>% \n      hc_xAxis(categories = temp_rada$index,\n               tickmarkPlacement = 'on',\n               lineWidth = 0) %>% \n      hc_yAxis(gridLineInterpolation = 'polygon',\n               lineWidth = 0,\n               min = 0, max = 1) %>% \n      hc_series(\n        list(\n          name = \"省電大戶\",\n          data = temp_rada[,c(2)],\n          pointPlacement = 'on',color=col.raw[8]),\n        list(\n          name = \"用電大戶\",\n          data = temp_rada[,c(3)],\n          pointPlacement = 'on',color='#474747')\n      )\n  })\n  \n  ################### 各行政區part #####\n  output$detail_big_plot <- renderPlotly({\n    power_area %>% \n      filter(統計年月 == input$detail_time_big) %>% \n      filter(鄉鎮 == input$area_c) %>% \n      arrange(desc(每人平均用電度數)) %>% \n      slice(1:input$detail_n_big) %>% \n      ggplot(aes(x = reorder(行政區域, desc(每人平均用電度數)), y = 每人平均用電度數)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5))) -> plot_tmp_area\n    ggplotly(plot_tmp_area)\n  })\n  \n  output$detail_growth_plot <- renderPlotly({\n    power_area %>% \n      filter(統計年月 %in% c(input$detail_time_growth1,input$detail_time_growth2)) %>%\n      filter(鄉鎮 == input$area_c) %>% \n      group_by(行政區域) %>% \n      arrange(desc(統計年月)) %>% \n      mutate(base = lead(每人平均用電度數, 1),\n             用電量成長比例 = (每人平均用電度數 - base)/base) %>% \n      ungroup %>% \n      arrange(desc(用電量成長比例)) %>% \n      slice(1:input$detail_n_growth) %>% \n      ggplot(aes(x = reorder(行政區域, desc(用電量成長比例)), y = 用電量成長比例)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5))) -> plot_tmp_area1\n    ggplotly(plot_tmp_area1)\n  })\n  \n  ## 省電大戶 by lofu\n  output$detail_small_plot <- renderPlotly({\n    power_area %>% \n      filter(統計年月 == input$detail_time_small) %>% \n      filter(鄉鎮 == input$area_d) %>% \n      arrange(每人平均用電度數) %>% \n      slice(1:input$detail_n_small) %>% \n      ggplot(aes(x = reorder(行政區域,每人平均用電度數), y = 每人平均用電度數)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5))) -> plot_tmp_area2\n    ggplotly(plot_tmp_area2)\n  })\n  \n  ## 省電成長大戶 by lofu\n  output$detail_decay_plot <- renderPlotly({\n    power_area %>% \n      filter(統計年月 %in% c(input$detail_time_decay1,input$detail_time_decay2)) %>%\n      filter(鄉鎮 == input$area_d) %>% \n      group_by(行政區域) %>% \n      arrange(desc(統計年月)) %>% \n      mutate(base = lead(每人平均用電度數, 1),\n             省電量成長比例 = (每人平均用電度數 - base)/base) %>% \n      ungroup %>% \n      arrange(省電量成長比例) %>% \n      slice(1:input$detail_n_decay) %>% \n      ggplot(aes(x = reorder(行政區域, 省電量成長比例), y = 省電量成長比例)) +\n      geom_bar(stat = 'identity',fill= \"#4595D6\") + ## 加顏色崇甫\n      theme_bw(base_family=\"STHeiti\") +\n      labs(x = '行政區域') + \n      theme(axis.text.x=element_text(angle =20 ,size=10),\n            axis.text.y=element_text(size=15),axis.title.x=element_text(size=15),\n            axis.title.y=element_text(size=20),plot.title = element_text(size = rel(1.5))) -> plot_tmp_area3\n    ggplotly(plot_tmp_area3)\n  })\n  \n  output$demo <- renderHighchart({\n    hcmix\n  })\n  \n  output$人口特性 <- renderInfoBox({\n    infoBox(\n      \"Property of Population\", paste0(\"Six Special Index\",\"\"), icon = icon(\"users\"),\n      color = \"yellow\",fill =TRUE\n    )\n  })\n  output$單身小資 <- renderInfoBox({\n    infoBox(\n      \"Cluster-5\",p(\"。Single\",br(),\"。Female\"), icon = icon(\"female\"),\n      color = \"red\",fill =TRUE\n    )\n  })\n  output$高知識 <- renderInfoBox({\n    infoBox(\n      \"Cluster-1\", p(\"。High-Education\",br(),\"。High-Income\"), icon = icon(\"money\"),\n      color = \"green\",fill =TRUE\n    )\n  })\n  \n  output$銀髮族 <- renderInfoBox({\n    infoBox(\n      \"Cluster-3\", p(\"。Elderly\",br(),\"。Low-Income\"), icon = icon(\"battery-empty\"),\n      color = \"light-blue\",fill =TRUE\n    )\n  })\n  output$電力 <- renderInfoBox({\n    infoBox(\n      \"電量\", p(\"。用電大戶\",br(),\"。省電大戶\"), icon = icon(\"bolt\"),\n      color = \"yellow\",fill =TRUE\n    )\n  })\n  output$時間 <- renderInfoBox({\n    infoBox(\n      \"時間\", p(\"。年度\",br(),\"。月份\"), icon = icon(\"clock-o\"),\n      color = \"blue\",fill =TRUE\n    )\n  })\n}\n\nshinyApp(ui, server) \n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1475163710088.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "605873685",
    "id" : "45331154",
    "lastKnownWriteTime" : 1471601108,
    "last_content_update" : 1471601108,
    "path" : "~/Downloads/7e2341016f794af290f03abcf91e6685/app.r",
    "project_path" : "app.r",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}